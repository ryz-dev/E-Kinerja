BEGIN
	DECLARE bDone INT;

	DECLARE chkTime DATETIME;
	DECLARE chkType VARCHAR(1);
	DECLARE _sn VARCHAR(20);
	DECLARE _nip VARCHAR(20);
	DECLARE _dates DATE;
	DECLARE counter INT;

	DECLARE curs CURSOR FOR
		SELECT adms_db.checkinout.checktime,
		adms_db.checkinout.checktype,
		adms_db.checkinout.SN,
		adms_db.userinfo.Card
		FROM adms_db.checkinout
		JOIN adms_db.userinfo
		ON adms_db.checkinout.userid=adms_db.userinfo.userid
		WHERE DATE(checktime)= tanggal_pilihan;

	DECLARE CONTINUE HANDLER FOR NOT FOUND SET bDone = 1;

-- 	DROP TEMPORARY TABLE IF EXISTS tblResults;
-- 	CREATE TEMPORARY TABLE IF NOT EXISTS tblResults  (
-- 	    chkTime DATETIME,
-- 		chkType VARCHAR(1),
-- 		sn VARCHAR(20),
-- 		nip VARCHAR(20),
-- 		tanggal DATE,
-- 		counter INT
-- 	  );

	OPEN curs;

	SET counter = 0;
	REPEAT
		FETCH curs INTO chkTime, chkType, _sn, _nip;
			SET counter = (SELECT count(nip) FROM checkinout WHERE nip = RTRIM(LTRIM(_nip) AND checktime=chkTime AND checktype=chkType AND sn=_sn ) );
			IF (counter = 0 ) THEN
				IF (_nip) THEN
					INSERT INTO checkinout (nip,checktime,checktype,sn) values(_nip, chkTime, chkType,_sn);
-- 					INSERT INTO tblResults VALUES (chkTime, chkType, _sn, _nip, _dates, counter);
				END IF;
			END IF;
		SET counter = 0;
	UNTIL bDone END REPEAT;
-- 	checktime=chkTime AND checktype=chkType AND sn=_sn AND
	CLOSE curs;
-- SELECT * FROM tblResults;
END